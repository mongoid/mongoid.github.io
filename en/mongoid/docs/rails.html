<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
  <head>
    <meta content='A Ruby ODM for MongoDB' name='description' />
    <meta content='mongoid, mongodb, ruby, rails, odm, durran jordan' name='keywords' />
    <link href="/stylesheets/bootstrap.min.css" media="screen" rel="stylesheet" type="text/css" />
    <link href="/stylesheets/mongoid.css" media="screen" rel="stylesheet" type="text/css" />
    <link href="/stylesheets/mongoid-coderay.css" media="screen" rel="stylesheet" type="text/css" />
    <link href="/stylesheets/bootstrap-responsive.min.css" media="screen" rel="stylesheet" type="text/css" />
    <script src="/javascripts/jquery-1.7.2.js" type="text/javascript"></script>
    <script src="/javascripts/bootstrap-dropdown.js" type="text/javascript"></script>
    <script src="/javascripts/bootstrap-scrollspy.js" type="text/javascript"></script>
    <script src="/javascripts/bootstrap-tooltip.js" type="text/javascript"></script>
    <script src="/javascripts/mongoid.js" type="text/javascript"></script>
    <title>Mongoid: Rails</title>
  </head>
  <body data-offset='100' data-spy='scroll' data-target='.page-nav'>
    <div class='basic' id='header'>
      <div class='navbar navbar-fixed-top'>
        <div class='navbar-inner'>
          <div class='container'>
            <ul class='nav'>
              <li class='dropdown link' id='project'>
                            <a title="Mongoid" href="/en/mongoid/"><img src="/images/mongoid-logo-small-green.png" />
                </a>
    
              </li>
              <li class='link'>
                            <a title="Origin" href="/en/origin/"><img src="/images/origin-logo-small-white.png" />
                </a>
    
              </li>
              <li class='link'>
                            <a title="Moped" href="/en/moped/"><img src="/images/moped-logo-small-white.png" />
                </a>
    
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
    <div id='navigation'>
      <div class='subnav'>
        <div class='container'>
          <ul class='nav nav-pills'>
            <li><a href="/en/mongoid/">HOME</a></li>
            <li class='dropdown' id='docs'>
              <a class='dropdown-toggle' data-toggle='dropdown' href='#docs'>
                DOCS
                <b class='caret'></b>
              </a>
              <ul class='dropdown-menu'>
                <li><a href="/en/mongoid/docs/installation.html">Installation</a></li>
                <li><a href="/en/mongoid/docs/documents.html">Documents</a></li>
                <li><a href="/en/mongoid/docs/persistence.html">Persistence</a></li>
                <li><a href="/en/mongoid/docs/querying.html">Querying</a></li>
                <li><a href="/en/mongoid/docs/relations.html">Relations</a></li>
                <li><a href="/en/mongoid/docs/nested_attributes.html">Nested Attributes</a></li>
                <li><a href="/en/mongoid/docs/identity_map.html">Identity Map</a></li>
                <li><a href="/en/mongoid/docs/callbacks.html">Callbacks</a></li>
                <li><a href="/en/mongoid/docs/validation.html">Validation</a></li>
                <li><a href="/en/mongoid/docs/indexing.html">Indexing</a></li>
                <li><a href="/en/mongoid/docs/rails.html">Rails</a></li>
                <li><a href="/en/mongoid/docs/extras.html">Extras</a></li>
                <li><a href="/en/mongoid/docs/upgrading.html">Upgrading</a></li>
                <li><a href="/en/mongoid/docs/contributing.html">Contributing</a></li>
                <li><a href="/en/mongoid/docs/performance.html">Performance</a></li>
              </ul>
            </li>
            <li><a href="/en/mongoid/links.html">LINKS</a></li>
          </ul>
        </div>
      </div>
    </div>
    <div id='content'>
      <div class='container'>
        <h1>Rails</h1>
        <p>
          Mongoid was built and targeted towards Rails applications, even though it
          will work in any environment. However if you are using Rails consult the
          next two sections on how Mongoid hooks into a Rails application.
        </p>
        <p>
          For a sample Rails application and examples of domain modeling, please see
          the Mongoid demo application,
          <a href="http://github.com/mongoid/echo">Echo</a>. Note that currently the
          application is only models and specs.
        </p>
        <div class='page-nav'>
          <div class='container'>
            <ul class='nav nav-pills'>
              <li><a href="#multi_param">Multi-Parameter Attributes</a></li>
              <li><a href="#railties">Railties</a></li>
              <li><a href="#rake">Rake Tasks</a></li>
            </ul>
          </div>
        </div>
        <section id='multi_param'>
          <h2>Multi Parameter Attributes</h2>
          <p>
            If you want to use multi-paramater attributes with Rails, you will
            need to include an extra Mongoid module to support it.
          </p>
          <div class='well'>
            <table>
              <tr>
                <td class='samurai'><img src="/images/samurai.png" /></td>
                <td class='note'>
                  The reason for needing to include a module is due to the fact that
                  we believe this is not a very usable way of handling date/time
                  entry in forms, with a complex implementation.
                </td>
              </tr>
            </table>
          </div>
          <div class="CodeRay">
            <div class="code"><pre><span class="keyword">class</span> <span class="class">Person</span>&#x000A;  include <span class="constant">Mongoid</span>::<span class="constant">Document</span>&#x000A;  include <span class="constant">Mongoid</span>::<span class="constant">MultiParameterAttributes</span>&#x000A;<span class="keyword">end</span>&#x000A;</pre></div>
          </div>
        </section>
        <section id='railties'>
          <h2>Railties</h2>
          <p>
            Mongoid provides some railties and initializers that one should be
            aware of when writing a Rails application with Mongoid.
          </p>
          <h3>Configuration</h3>
          <p>
            You can set Mongoid configuration options in your <tt>application.rb</tt>
            along with other Rails environment specific options by accessing
            <code>config.mongoid</code>. Options set here will override those set in
            your <code>config/mongoid.yml</code>.
          </p>
          <div class="CodeRay">
            <div class="code"><pre><span class="keyword">module</span> <span class="class">MyApplication</span>&#x000A;  <span class="keyword">class</span> <span class="class">Application</span> &lt; <span class="constant">Rails</span>::<span class="constant">Application</span>&#x000A;    config.mongoid.logger = <span class="constant">Logger</span>.new(<span class="global-variable">$stdout</span>, <span class="symbol">:warn</span>)&#x000A;    config.mongoid.persist_in_safe_mode = <span class="predefined-constant">true</span>&#x000A;  <span class="keyword">end</span>&#x000A;<span class="keyword">end</span>&#x000A;</pre></div>
          </div>
          <h3>Model Preloading</h3>
          <p>
            In order to properly set up single collection inheritance, Mongoid
            needs to preload all models before every request in development mode.
            This can get slow, so if you are not using any inheritance it is
            recommended you turn this feature off.
          </p>
          <div class="CodeRay">
            <div class="code"><pre>config.mongoid.preload_models = <span class="predefined-constant">false</span>&#x000A;</pre></div>
          </div>
          <h3>Exceptions</h3>
          <p>
            Similar to Active Record, Mongoid tells raise to return specific http
            codes when some errors are raised.
            <ul>
              <li><code>Mongoid::Errors::DocumentNotFound</code> : 404</li>
              <li><code>Mongoid::Errors::Validations</code> : 422</li>
            </ul>
          </p>
          <h3>Unicorn and Passenger</h3>
          <p>
            When using Unicorn or Passenger, each time a child process is forked
            when using app preloading or smart spawning, Mongoid will automatically
            reconnect to the master database. If you are doing this in your
            application manually you may remove your code.
          </p>
        </section>
        <section id='rake'>
          <h2>Rake Tasks</h2>
          <p>
            Mongoid provides the following rake tasks when used in a Rails 3 environment:
          </p>
          <ul>
            <li>
              <code>db:create</code>: Exists only for dependency purposes, does not actually
              do anything.
            </li>
            <li>
              <code>db:create_indexes</code>: Reads all index definitions from the models and
              attempts to create them in the database.
            </li>
            <li>
              <code>db:remove_indexes</code>: Reads all index definitions from the models and
              attempts to remove indexes that are not defined.
            </li>
            <li>
              <code>db:drop</code>: Drops all collections in the database with the exception of
              the system collections.
            </li>
            <li>
              <code>db:migrate</code>: Exists only for dependency purposes, does not actually
              do anything.
            </li>
            <li>
              <code>db:schema:load</code>: Exists only for framework dependency purposes, does
              not actually do anything.
            </li>
            <li>
              <code>db:seed</code>: Seeds the database from db/seeds.rb
            </li>
            <li>
              <code>db:setup</code>: Creates indexes and seeds the database.
            </li>
            <li>
              <code>db:test:prepare</code>: Exists only for framework dependency purposes, does
              not actually do anything.
            </li>
          </ul>
        </section>
      </div>
    </div>
  </body>
</html>
